In the last few years, there has been significant growth in grid-connected distributed energy resources (DERs). This has lead to an increased deployment of distributed generation (DG) and distributed storage (DS) systems. Moreover, companies are starting to heavily invest in the competitive energy storage system market with a goal of decreasing the cost of energy storage. Although a significant amount of DG and DS are being added to the distribution grid they are still not ready for a seamless integration to the grid due to the lack of control and intermittent nature of non-dispatchable DGs \cite{denholm2016path}. In the US most DG and DS systems are deployed to either help reduce the metered load through net metering program or to sell power to the utility through power purchase agreements (PPAs). These methods fail to fully utilize the potential of DG combined with DS systems due to the lack of proper control and dispatchability. That is why a sophisticated energy management solution is required to maximize the use of available DERs. Such an energy management solution will be able to dynamically optimize the use of all available resources in order to serve the load the most economical and safe way. This will benefit both utility companies and regular consumers. Due to constraints and intermittent nature of some DER systems, such as wind and solar the optimum energy management of DERs is a complex problem tackled by many researchers.

Energy management algorithms which deal with both variable DG and real-time pricing can be divided into two main categories, offline and real-time algorithms \cite{rt_shi_2017}. The offline optimization algorithms usually optimize the energy management for a predetermined time horizon based on prediction data. Some research has been done considering perfect prediction of the future \cite{Off_1,off_2,off_3,off_4}. But in reality, there are uncertainties in the prediction horizon. To solve the problem of reliance on perfect prediction some offline algorithms, try to model the uncertainties in a day ahead scheduling and try to develop optimum schedules taking into account the probable uncertainties. \cite{ous_1,ous_2} use mixed integer linear programming for optimizing DERs. To take into account the uncertainties in the prediction horizon \cite{ous_2} generates multiple solutions based on different scenarios. \cite{ous_1} also produces different risk averse and risk-neutral options. In both cases, the scenarios are generated stochastically. The number of scenarios required to be generated to properly capture the uncertainties are large in number. This makes these process computationally extensive. The researchers in \cite{ous_3} formulate the optimization problem based on the worst-case scenario. The solution method considers the most cost from the grid and the least benefits from using local DG resources. The uncertainty of the grid is expressed as set points in Taguchi’s orthogonal array. Then search strategy based on Taguchi’s orthogonal array is used to find the best possible solution cases. Using the worst case to formulate the problem makes the solution robust for all situations. Although this method provides a robust solution always taking into account worst scenario makes the solution suboptimal. 

There have been advances recently in designing real-time algorithms that optimize the long-term cost of the energy management system taking into account the intermittent nature of the loads and DGs in the grid. Researchers in \cite{rt1} use an aggregator to minimize the long-term cost of the grid. The solution used Lyapunov optimization to solve the energy management problem in real-time. The method proposed does not consider the actual architecture of the grid and optimizes considering all the components are connected to the same bus. This makes it impractical due to the actual grid having line constraints that cannot be violated.\cite{rt2} formulates the problem as a real-time one leader N-follower Stackelberg game and shows an efficient approach designed to optimize the system based on a demand response scheme. The optimization is performed by creating a virtual electricity trading market where the facility (leader) produces virtual prices of electricity and the resources (followers) compete to buy and sell electricity. The researchers show the existence of unique Stackelberg equilibrium for optimum use of each resource. In \cite{rt3}, researchers propose a multi-period AC optimal power flow taking into account the uncertainties of the solar and wind resources to ensure reliable solutions for the distribution system operators. In the first stage the algorithm contacts with all the available resources to determine the upper and lower bounds of generation throughout the next day. The upper and lower bounds of the different units are termed as flexibility in the paper. In the second stage which is the real-time operation, the algorithm optimizes in real-time taking into account the flexibility of the available resources.  \cite{rt4} proposes to solve the problem using an online energy management system in real-time using Lyapunov optimization taking into account the physical constraints of the system.
The drawbacks of these methods are that most of them do not take into account the actual distribution system architecture while formulating the problem. Only \cite{rt4} considers system architecture while optimizing in real-time. But a lack of prediction based elements makes these methods optimal for short-term costs but suboptimal for properly optimizing long-term operating cost.

From the discussion thus far it is evident that there is a need for a real-time energy management solution(EMS) that can optimize the long-term operating cost of a system containing  DG and energy storage (ES). This paper presents an optimal real-time control strategy for such systems. The proposed control strategy takes into account the forecasted states of the available resources and real-time price to optimize the total cost of energy usage. the rest of the paper is structured as follows. Section II introduces the formulation of the problem as a graph search. Section III introduces the A* search algorithm which is used to solve the optimization problem. Section IV discusses the test system. Section V presents results and section VI presents the conclusions.

